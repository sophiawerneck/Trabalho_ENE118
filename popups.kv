#:kivy 1.11.1
<ModbusPopup>:
    title: "Configurações MODBUS"
    size_hint_y: None
    size_hint_x: 0.4
    height: 200
    BoxLayout:
        id: layout
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 2
            Label:
                text: "IP"
                fonte_size: 14
            TextInput: 
                id: txt_ip
                text: "127.0.0.1"
                fonte_size: 14
                haling: 'center'
                valing: 'middle'
            Label:
                text: "Porta"
                fonte_size: 14
            TextInput: 
                id: txt_porta
                text: "502"
                fonte_size: 14
                haling: 'center'
                valing: 'middle'                
        BoxLayout:
            orientation:'horizontal'
            Button: 
                size_hint_y: None
                height: 40
                text: "Conectar"
                on_release:
                    root.clearInfo()
                    app.root.startDataRead(txt_ip.text, int(txt_porta.text))
            Button: 
                size_hint_y: None
                height: 40
                text: "Fechar"
                on_release:
                    root.dismiss() 
                    root.clearInfo()

<ScanPopup>:
    title: "Configurações ScanTime"
    size_hint_y: None
    size_hint_x: 0.4
    height: 150
    BoxLayout:
        id: layout
        orientation: 'vertical'
        GridLayout:
            cols: 2
            rows: 1
            Label:
                text: "ScanTime [ms]"
                fonte_size: 14
            TextInput: 
                id: txt_st
                fonte_size: 14
                haling: 'center'
                valing: 'middle'
        BoxLayout:
            orientation:'horizontal'
            Button:
                size_hint_y: None
                height: 40
                text: "Configurar" #modficar o atributo scan_time da calsse MyWidget
                on_release:
                    app.root._scan_time = int(txt_st.text)
                    print(app.root._scan_time)
            Button: 
                size_hint_y: None
                height: 40
                text: "Fechar"
                on_release:
                    root.dismiss() 

<MedicoesPopup>:
    title:"Medições de variáveis elétricas"
    size_hint_y: None
    size_hint_x: 0.8
    height: 650
    BoxLayout:
        orientation: "vertical"
        GridLayout:
            cols: 2
            rows: 13
            GridLayout:
                cols: 2
                rows: 13
                Label:
                    text: "Frequência da rede"
                    font_size: 14
                Label:
                    id: frequencia
                    text: '-.- Hz'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                    
                Label:
                    text: "Demanda atual"
                    font_size: 14
                Label:
                    id: demanda_atual
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Demanda prevista"
                    font_size: 14
                Label:
                    id: demanda_prevista
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Demanda média"
                    font_size: 14
                Label:
                    id: demanda_media
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Demanda anterior"
                    font_size: 14
                Label:
                    id: demanda_anterior
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Demanda de pico"
                    font_size: 14
                Label:
                    id: demanda_pico
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle" 

                Label:
                    text: "Energia ativa"
                    font_size: 14
                Label:
                    id: energia_ativa
                    text: '-.- kW/h'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"    

                Label:
                    text: "Potência ativa total"
                    font_size: 14
                Label:
                    id: ativa_total
                    text: '-.- W'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"  

                Label:
                    text: "Potência aparente total"
                    font_size: 14
                Label:
                    id: aparente_total
                    text: '-.- VA'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"   
                
                Label:
                    text: "Fator de Potência Total"
                    font_size: 14
                Label:
                    id: fp_total
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Tensão entre R e S"
                    font_size: 14
                Label:
                    id: tensao_rs
                    text: '-.- V'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Tensão entre S e T"
                    font_size: 14
                Label:
                    id: tensao_st
                    text: '-.- V'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Tensão entre T e R"
                    font_size: 14
                Label:
                    id: tensao_tr
                    text: '-.- V'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

            GridLayout:
                cols: 2
                rows: 13
                Label:
                    text: "Corrente Média"
                    font_size: 14
                Label:
                    id: corrente_media
                    text: '-.- A'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Corrente na fase R"
                    font_size: 14
                Label:
                    id: corrente_r
                    text: '-.- A'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Corrente na fase S"
                    font_size: 14
                Label:
                    id: corrente_s
                    text: '-.- A'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Corrente na fase T"
                    font_size: 14
                Label:
                    id: corrente_t
                    text: '-.- A'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Corrente no neutro"
                    font_size: 14
                Label:
                    id: corrente_n
                    text: '-.- A'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Temperatura Enrolamento R"
                    font_size: 14
                Label:
                    id: temp_r
                    text: '-.- °C'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Temperatura Enrolamento S"
                    font_size: 14
                Label:
                    id: temp_s
                    text: '-.- °C'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Temperatura Enrolamento T"
                    font_size: 14
                Label:
                    id: temp_t
                    text: '-.- °C'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "THD tensão entre R e S"
                    font_size: 14
                Label:
                    id: thd_tensao_rs
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "THD tensão entre S e T"
                    font_size: 14
                Label:
                    id: thd_tensao_st
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "THD tensão entre T e R"
                    font_size: 14
                Label:
                    id: thd_tensao_tr
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                Label:
                    text: "Tipo do motor(1=Verde/2=Azul)"
                    font_size: 14
                Label:
                    id: tipo_motor
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"

                Label:
                    text: "Status do PID(0=Autom./1=Manual)"
                    font_size: 14
                Label:
                    id: status_pid
                    text: '-.-'
                    font_size: 14
                    haligh: "center"
                    valign: "middle"
                
                

<ComandoPopup>:
    title:"Comandos do motor"
    size_hint_y: None
    size_hint_x: 0.8
    height: 500
    GridLayout:
        cols:3
        BoxLayout:
            orientation: "vertical"
            size_hint_x: 0.3
            Label:
                text: "Tipo de partida"
                font_size: 14
            Button:                        
                text: "Direta"
                height: 100 
                on_release: app.root.selPartida(3)            
            Button:
                text: "Inversor"
                height: 100
                on_release: app.root.selPartida(2)
            Button:
                text: "Soft-start"
                height: 100
                on_release: app.root.selPartida(1)

        BoxLayout:
            orientation: "vertical"
            size_hint_x: 0.3
            Label:
                text: "Comando da esteira"
                font_size: 14
            Button:                        
                text: "Ligar"
                height: 100   
                on_release: app.root.ligaEsteira(acel = int(in_acel.text), desacel = int(in_desacel.text), vel = int(velInversor.text))          
            Button:
                text: "Desligar"
                height: 100
                on_release: app.root.desligaEsteira()
            Button:
                text: "Reset"
                height: 100
                on_release: app.root.resetEsteira()
        
        
        BoxLayout:
            orientation: "vertical"
            size_hint_x: 0.4  
            Label:
                text: "Comandos do inversor/ soft-start"
                font_size: 14
                size_hint_y: 0.33
            BoxLayout:
                orientation: "horizontal"
                BoxLayout:
                    orientation: "vertical"
                    GridLayout:
                        cols:2
                        rows:2
                        Label:
                            text: "Acel.(s)"
                        TextInput:
                            id: in_acel # inversor/soft-start
                            font_size: 14
                            text: "10"
                            haligh: "center"
                            valign: "middle"
                            multiline: False
                        Label:
                            text: "Desacel.(s)"
                        TextInput:
                            id: in_desacel
                            font_size: 14
                            text: "10"
                            haligh: "center"
                            valign: "middle"
                            multiline: False
                    BoxLayout:
                        orientation: "vertical"
                        Label:
                            text:"Aceleração e"
                            bold: True
                        Label:
                            text:"desaceleração"
                            bold: True
                        Label:
                            haligh: "center"
                            text:"      Min: 10s Max: 60s"     

                    BoxLayout:
                        orientation: "vertical"
                        Label:
                            text:"Velocidade(0 a 60Hz)"
                            bold: True
                        TextInput:
                            id: velInversor
                            font_size: 14
                            text: "60"
                            haligh: "center"
                            valign: "middle"
                            multiline: False


                Slider:
                    id: slider_vel
                    min: 0
                    max: 60
                    value: 0
                    step: 1
                    orientation: 'vertical'
                    on_touch_move: app.root.setSlider(self.value)
                    size_hint: (None, 1)
                    width: 100
            

<PidPopup>:
    title:"Configuração PID esteira"
    size_hint_y: None
    size_hint_x: 0.8
    height: 600
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            orientation: "vertical"
            Label:
                text: "Modo de operação:"
                font_size: 16
            GridLayout:
                cols: 2
                rows:2
                Label:
                    text:"Automático"
                    font_size: 14
                CheckBox:
                    id: sel_pid_aut
                    text: "Automático"
                    size: 50, 10
                    group: 'aut/man'
                    active: False
                Label:
                    text:"Manual"
                    font_size: 14
                CheckBox:
                    id: sel_pid_man
                    text: "Manual"
                    size: 50, 10
                    group: 'aut/man'                   
                    active: True
                
        GridLayout:
            cols: 2
            rows:4
            Label:
                text: "Defina o valor da variável manipulada -MV (%):"
                font_size: 14
            TextInput:
                id: mv_escreve
                font_size: 14
                text: '0.0'
                haligh: "center"
                valign: "middle"
                on_text_validate: app.root.setMV(mv_escreve.text)
                multiline: False
            Label:
                text: "P:"
                font_size: 14
            TextInput:
                id: p
                font_size: 14
                text: "5.0"
                haligh: "center"
                valign: "middle"
                on_text_validate: app.root.setP(p.text)   
                multiline: False
            Label:
                text: "I:"
                font_size: 14
            TextInput: 
                id: i
                font_size: 14
                text: "5.0"
                haligh: "center"
                valign: "middle"
                on_text_validate: app.root.setI(i.text)
                multiline: False
            Label:
                text: "D:"
                font_size: 14
            TextInput:
                id: d
                font_size: 14
                text: "5.0"
                haligh: "center"
                valign: "middle"
                on_text_validate: app.root.setD(d.text)
                multiline: False

<HistGraphPopup>:
    title: " Histórico de dados"
    BoxLayout:
        orientation: "vertical"
        TimeSeriesGraph:
            id: graph
            xlabel: "Tempo"
            ylabel: "Valores"
            background_color: 0.5, 0.5, 0.5, 0.5
            x_ticks_minor: 5
            x_ticks_major: 10
            y_ticks_major: 100
            y_grid_label: True
            x_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin: 0 #xmax definido na classe DataGraphPopup
            ymin: 0
            ymax: 500
        BoxLayout:
            id: sensores
            orientation: "horizontal"
            size_hint: (1,0.1)

        BoxLayout:
            orientation: "horizontal"
            size_hint: (1,0.1)
            BoxLayout:
                orientation: "horizontal"
                size_hint: (0.5,1)
                Label:
                    text: "Timestamp inicial \r\n [size=12](DD/MM/AAAA HH:MM:SS)[/size]"
                    halign: "center"
                    markup: True
                TextInput:
                    id: txt_init_time
                    multiline: False
                    size_hint: (1,0.8)
                    halign: "center"
                    valign: "middle"
                Label:
                    text: "Timestamp final \r\n [size=12](DD/MM/AAAA HH:MM:SS)[/size]"
                    halign: "center"
                    markup: True
                TextInput:
                    id: txt_final_time
                    multiline: False
                    size_hint: (1,0.8)
                    halign: "center"
                    valign: "middle"
                Button:
                    text: "Fechar"
                    size_hint: (1,0.8)
                    on_release: root.dismiss()

<LabeledCheckBoxHistGraph>:
    orientation: "horizontal"
    size_hint: (0.05,1)
    BoxLayout:
        orientation: "vertical"
        CheckBox:
            id: checkbox
            group: "bd_group"
            on_active: app.root.getDataDB()
        Label:
            id: label
            font_size: 10
            bold: True

<DataGraphPopup>:
    title: "Gráficos das medidas"
    BoxLayout:
        orientation: 'vertical'
        TimeSeriesGraph:
            id: graph
            xLabel: 'Horário'
            yLabel: 'Valor []'
            blackground_color: 0.5,0.5,0.5,0.5
            x_ticks_minor: 1 # Número de subdivisões do eixo horizontal
            x_ticks_major: 5 # 5
            y_ticks_major: 5 # A cada 5 graus um subdivisão
            x_grid_label: True
            y_grid_label: True
            padding: 5
            x_grid: True
            y_grid: True
            xmin: 0
            ymax: 30 # 60
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.1)
            CheckBox:
                id: checktempcarcx
                group: "select_gp"
            CheckBox:
                id: checkrpm
                group: "select_gp"
            CheckBox:
                id: checktorquex
                group: "select_gp"
            CheckBox:
                id: checklecargax
                group: "select_gp"
            CheckBox:
                id: checkesteirax
                group: "select_gp"
            CheckBox:
                id: checkcorrentex
                group: "select_gp"
            
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.1)
            Label:
                text: "   Temperatura na carcaça (°C)"
                font_size: '9sp'
            Label:
                text: "Frequência de rotação (RPM)"
                font_size: '9sp'
            Label:
                text: "   Torque (N.m)"
                font_size: '9sp'
            Label:
                text: "   Carga do motor (Kgf/m²)"
                font_size: '9sp'
            Label:
                text: "   Velocidade da esteira (m/min)"
                font_size: '9sp'
            Label:
                text: "   Corrente (A)"
                font_size: '9sp'
        BoxLayout:
            orientation: 'horizontal'
            size_hint: (1,0.05)
            BoxLayout:
                orientation: 'horizontal'
                size_hint: (0.5,1)
                Label:
                    size_hint: (0.3,1)
                    text: "Número de pontos do gráfico"
                LabeledCheckBoxDataGraph:
                    id:mp20
                    on_kv_post: 
                        self.ids.label.text = '20'
                        self.ids.checkbox.group = 'cb_group'
                LabeledCheckBoxDataGraph:
                    id:mp50
                    on_kv_post: 
                        self.ids.label.text = '50'
                        self.ids.checkbox.group = 'cb_group'
                LabeledCheckBoxDataGraph:
                    id:mp100
                    on_kv_post: 
                        self.ids.label.text = '100'
                        self.ids.checkbox.group = 'cb_group'
            Button:
                text: "Fechar"
                size_hint:(0.2,1)
                on_release: root.dismiss()


<LabeledCheckBoxDataGraph>:
    orientation: 'horizontal'
    size_hint: (0.1,1)
    CheckBox:
        id: checkbox
        on_active: app.root._graph.ids.graph.setMaxPoints(int(label.text),0) if app.root is not None else None
    Label:
        id:label
